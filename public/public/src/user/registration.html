<link href="asset/css/registration.css" rel="stylesheet">

<div class="container">
    <div class="row centered-form">
        <div class="col-xs-12 col-sm-8 col-md-4 col-sm-offset-2 col-md-offset-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Please Sign Up<small>It's free!</small></h3>
                </div>
                <div class="panel-body">
                    <form role="form">
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <div class="form-group">
                                    <input type="text" name="firstName" class="form-control input-sm" placeholder="First Name">
                                </div>
                            </div>
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <div class="form-group">
                                    <input type="text" name="lastName" class="form-control input-sm" placeholder="Last Name">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <div class="form-group">
                                    <input type="email" name="email" class="form-control input-sm" placeholder="Email Address">
                                </div>
                            </div>
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <div class="form-group">
                                    <input type="text" name="phone" class="form-control input-sm" placeholder="Phone">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="text" name="address1" class="form-control input-sm" placeholder="Address">
                        </div>
                        <div class="form-group">
                            <input type="text" name="address2" class="form-control input-sm" placeholder="Address">
                        </div>
                        <div class="form-group">
                            <input type="text" name="city" class="form-control input-sm" placeholder="City">
                        </div>
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <div class="form-group">
                                    <input type="checkbox" name="isTravelAgent" id="isTravelAgent" autocomplete="off" />
                                    <div class="btn-group">
                                        <label for="isTravelAgent" class="btn btn-default">
                                            <span class="glyphicon glyphicon-ok"></span>
                                            <span> </span>
                                        </label>
                                        <label for="isTravelAgent" class="btn btn-default active">
                                            Travel Agent
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <div class="form-group">
                                    <input type="checkbox" name="isAdmin" id="isAdmin" autocomplete="off" />
                                    <div class="btn-group">
                                        <label for="isAdmin" class="btn btn-default">
                                            <span class="glyphicon glyphicon-ok"></span>
                                            <span> </span>
                                        </label>
                                        <label for="isAdmin" class="btn btn-default active">
                                            Admin
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <div class="form-group">
                                    <input type="password" name="password" class="form-control input-sm" placeholder="Password">
                                </div>
                            </div>
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <div class="form-group">
                                    <input type="password" name="repeatPassword" class="form-control input-sm" placeholder="Confirm Password">
                                </div>
                            </div>
                        </div>

                        <input type="submit" value="Register" class="btn btn-info btn-block">

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!--
<div>
    <div>
        {{errorMessage}}
    </div>
    <form submit.trigger="register(this)" >
        <p>First Name: <input type="text" name="firstName"></p>
        <p>Last Name: <input type="text" name="lastName"></p>
        <p>Username: <input type="text" name="username"></p>
        <p>Email: <input type="text" name="email"></p>
        <p>Password: <input type="password" name="password"></p>
        <p>Repeat Password: <input type="password" name="repeatPassword"></p>
        <p><input type="submit" value="Register"></p>
    </form>
</div>
-->
<script>

    var errorMessage = '';

    function register(form){
        var firstName = form.elements.firstName.value;
        var lastName = form.elements.lastName.value;
        var email = form.elements.email.value;
        var username = form.elements.username.value;
        var password = form.elements.password.value;
        var repeatPassword = form.elements.repeatPassword.value;
        dpd.users.post({"username": username, "password": password, "firstName": firstName, "lastName": lastName, "email": email}, function(user, err) {
            if(err){
                errorMessage = JSON.stringify(err);
                $patchChanges();
            }else{
                dpd.users.login({"username": username, "password": password}, function(user, err) {
                    if(err){
                        errorMessage = JSON.stringify(err);
                        $patchChanges();
                    }else{
                        window.location.hash = '#app/home';
                    }
                });
            }
        });
        return false;
    }
</script>


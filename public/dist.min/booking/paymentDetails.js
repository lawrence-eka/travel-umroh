yalla.framework.addComponent("/dist/booking/paymentDetails",function(){function t(t,e,n,a){this.data=e,this.target=n,this.type=t,this.currentTarget=a}function e(t){return{}}function n(t){}function e(t){return{alert:new Alert(null,s,"payment"),booking:null,bu:(new Utils).bookings,inputActualPayment:!1}}function n(t){}function a(){var t=this.state.bu.status(this.state.booking);return t.code==this.state.bu.paymentRejected?"Payment is rejected by Travel Agent":t.code==this.state.bu.bookingExpired?"Booking is cancelled because there was no payment received within the booking expiration date":t.code==this.state.bu.bookingCancelled?"Booking was cancelled by user":t.code==this.state.bu.waitingForPayment?"Please make the payment before booking expires to avoid automatic cancellation":t.code==this.state.bu.paymentConfirmationPending?"Payment received, waiting for verification":"Payment received and verified"}function r(){var t=(this.target.form,this),e=t.state.booking;e.fromBank="",e.fromBankBranch="",e.fromAccountNumber="",e.fromAccountHolder="",e.actualPayment=0,e.paymentDate=null,dpd.bookings.put(e.id,e,function(e,n){t.state.alert.alert(n),n||(t.state.inputActualPayment=!1),s()})}function o(){this.state.inputActualPayment=!0,s("payment")}function i(){this.state.inputActualPayment=!1,s("payment")}function c(){var t=this.target.form,e=this,n=e.state.booking;return t.elements.actualPayment.value<n.totalPrice?void e.state.alert.alert({errors:[{actualPayment:"Cannot be less than Total Price"}]}):(n.fromBank=t.elements.fromBank.value,n.fromBankBranch=t.elements.fromBankBranch.value,n.fromAccountNumber=t.elements.fromAccountNumber.value,n.fromAccountHolder=t.elements.fromAccountHolder.value,n.actualPayment=t.elements.actualPayment.value,n.paymentDate=new Date(t.elements.paymentDate.value).getTime(),void dpd.bookings.put(n.id,n,function(t,n){e.state.alert.alert(n),n||(e.state.inputActualPayment=!1),s()}))}function m(t){var e=this;return new Promise(function(n){dpd.bookings.get(t,function(t,a){e.state.alert.alert(a),a||(e.state.booking=t,n(t))})})}function l(l,p){f["card-booking"]=u("/booking/card-booking");f["card-booking"];f.card=u("/component/panel");f.card;f.alert=u("/component/alert");f.alert;v("link",""),P("element","dist.booking.paymentDetails"),P("href","asset/css/custom-style.css"),P("rel","stylesheet"),k("link"),g("link"),f.entry=u("/component/entry");f.entry;f.ppLink=u("/component/ppLink");f.ppLink;v("div",""),P("element","dist.booking.paymentDetails"),k("div");var A=IncrementalDOM.currentElement(),w=yalla.framework.validComponentName(A,b);A._state=A._state&&w?A._state:e.bind(A)(l),A._state._name=b;var T=A._state,B={component:A,properties:l,state:A._state};w&&yalla.framework.propertyCheckChanges(A._properties,l,n.bind(B)),A._properties=l,v("div",""),k("div"),function(e){function n(e){var n={booking:T.booking,showOnly:"showOnly"};f["card-booking"].render("object"==typeof arguments[1]?y(arguments[1],n):n,function(t,e){}),v("span",""),k("span"),yalla.framework.registerRef("payment",IncrementalDOM.currentElement(),function(){if(!T.inputActualPayment&&(T.bu.status(e).code>T.bu.paymentConfirmationPending||T.bu.status(e).code==T.bu.paymentRejected)){var n={title:"Actual Payment",nofooter:"nofooter"};f.card.render("object"==typeof arguments[1]?y(arguments[1],n):n,function(n,a){if("body"===n){if(v("div",""),k("div"),h("From Bank: "+T.booking.fromBank),v("br",""),k("br"),g("br"),h("Branch: "+T.booking.fromBankBranch),v("br",""),k("br"),g("br"),h("Account No: "+T.booking.fromAccountNumber),v("br",""),k("br"),g("br"),h("Account Name: "+T.booking.fromAccountHolder),v("br",""),k("br"),g("br"),h("Amount: "+(T.booking.actualPayment?T.booking.actualPayment.toFormattedString():"")),v("br",""),k("br"),g("br"),h("Transfer Date: "+(T.booking.paymentDate?T.booking.paymentDate.toDateComponents(!1,!0):"")),v("div",""),P("class","row"),k("div"),T.bu.status(e).code==T.bu.paymentConfirmationPending||T.bu.status(e).code==T.bu.paymentRejected){var o={type:"button",name:"btnCancel",value:"Cancel/Delete Payment",onclick:function(e){var n={target:e.target};n.properties=l,"elements"in n.target&&(n.elements=n.target.elements),n.currentTarget=this==e.target?n.target:d(e.currentTarget),n.component=A,n.component._state=n.component._state||{},n.state=n.component._state,n.emitEvent=function(e,a){var r=new t(e,a,n.target,n.currentTarget);"on"+e in l&&l["on"+e](r)},r.bind(n)()}};f.entry.render("object"==typeof arguments[1]?y(arguments[1],o):o,function(t,e){})}g("div"),g("div")}})}if(!T.inputActualPayment){var n={title:"Payment Info",footer:a.bind(p)()};f.card.render("object"==typeof arguments[1]?y(arguments[1],n):n,function(n,a){if("body"===n){if(v("div",""),k("div"),h("Total: "+(T.booking.totalPrice?T.booking.totalPrice.toFormattedString():"")),v("br",""),k("br"),g("br"),h("Bank: Bank Central Asia"),v("br",""),k("br"),g("br"),h("Branch: Sidoarjo"),v("br",""),k("br"),g("br"),h("Account No:1234567890"),v("br",""),k("br"),g("br"),h("Name: PT Pete Tbk."),v("br",""),k("br"),g("br"),v("div",""),P("class","row"),k("div"),T.bu.status(e).code==T.bu.definingPassengers){var r={type:"button",name:"btnPaymentConfirmation",value:"Input Actual Payment",onclick:function(e){var n={target:e.target};n.properties=l,"elements"in n.target&&(n.elements=n.target.elements),n.currentTarget=this==e.target?n.target:d(e.currentTarget),n.component=A,n.component._state=n.component._state||{},n.state=n.component._state,n.emitEvent=function(e,a){var r=new t(e,a,n.target,n.currentTarget);"on"+e in l&&l["on"+e](r)},o.bind(n)()}};f.entry.render("object"==typeof arguments[1]?y(arguments[1],r):r,function(t,e){})}g("div"),g("div")}})}if(v("span",""),k("span"),yalla.framework.registerRef("alert",IncrementalDOM.currentElement(),function(){var t={alertType:T.alert.type.bind(p)(),message:T.alert.text.bind(p)()};f.alert.render("object"==typeof arguments[1]?y(arguments[1],t):t,function(t,e){})})(),g("span"),T.inputActualPayment){var n={title:"Payment Confirmation"};f.card.render("object"==typeof arguments[1]?y(arguments[1],n):n,function(e,n){if("footer"===e){v("div",""),k("div");var a={};f.ppLink.render("object"==typeof arguments[1]?y(arguments[1],a):a,function(t,e){}),g("div")}if("body"===e){v("div",""),k("div"),v("form",""),k("form");var a={type:"text",prompt:"Bank Name",name:"fromBank"};f.entry.render("object"==typeof arguments[1]?y(arguments[1],a):a,function(t,e){});var a={type:"text",prompt:"Bank Branch",name:"fromBankBranch"};f.entry.render("object"==typeof arguments[1]?y(arguments[1],a):a,function(t,e){});var a={type:"text",prompt:"Account Number",name:"fromAccountNumber"};f.entry.render("object"==typeof arguments[1]?y(arguments[1],a):a,function(t,e){});var a={type:"text",prompt:"Account Holder",name:"fromAccountHolder"};f.entry.render("object"==typeof arguments[1]?y(arguments[1],a):a,function(t,e){});var a={type:"number",prompt:"Amount Transfered",name:"actualPayment",min:T.booking.totalPrice,alert:T.alert};f.entry.render("object"==typeof arguments[1]?y(arguments[1],a):a,function(t,e){});var a={type:"datetime-local",prompt:"Transfer Date & Time",name:"paymentDate",value:(new Date).toYYYYMMDD(!0),max:(new Date).toYYYYMMDD(!0)};if(f.entry.render("object"==typeof arguments[1]?y(arguments[1],a):a,function(t,e){}),!T.booking.actualPayment){var a={type:"button",name:"btnSave",value:"Save",divClass:"col-xs-6 col-sm-6 col-md-6 col-lg-6",onclick:function(e){var n={target:e.target};n.properties=l,"elements"in n.target&&(n.elements=n.target.elements),n.currentTarget=this==e.target?n.target:d(e.currentTarget),n.component=A,n.component._state=n.component._state||{},n.state=n.component._state,n.emitEvent=function(e,a){var r=new t(e,a,n.target,n.currentTarget);"on"+e in l&&l["on"+e](r)},c.bind(n)()}};f.entry.render("object"==typeof arguments[1]?y(arguments[1],a):a,function(t,e){})}var a={type:"button",name:"btnCancel",value:T.booking.actualPayment?"Close":"Cancel",divClass:"col-xs-6 col-sm-6 col-md-6 col-lg-6",onclick:function(e){var n={target:e.target};n.properties=l,"elements"in n.target&&(n.elements=n.target.elements),n.currentTarget=this==e.target?n.target:d(e.currentTarget),n.component=A,n.component._state=n.component._state||{},n.state=n.component._state,n.emitEvent=function(e,a){var r=new t(e,a,n.target,n.currentTarget);"on"+e in l&&l["on"+e](r)},i.bind(n)()}};f.entry.render("object"==typeof arguments[1]?y(arguments[1],a):a,function(t,e){}),g("form"),g("div")}})}})(),g("span")}var u=e.element,p={target:u};p.properties=l,"elements"in p.target&&(p.elements=p.target.elements),p.currentTarget=p.target,p.component=A,p.component._state=p.component._state||{},p.state=p.component._state;var b=m.bind(p)(l.bookingId);b&&"object"==typeof b&&"then"in b?(D(),b.then(function(t){s(u,function(){n.call(p,t)})}).catch(function(t){console.log(t)})):n.call(p,b)}({element:IncrementalDOM.currentElement(),pointer:IncrementalDOM.currentPointer()}),g("div"),g("div")}var s=yalla.framework.renderToScreen,u=yalla.framework.createInjector("/dist/booking/paymentDetails"),p={},b="dist.booking.paymentDetails",f={},d=yalla.framework.getParentComponent,y=yalla.utils.merge,g=(IncrementalDOM.elementOpen,IncrementalDOM.elementClose),v=IncrementalDOM.elementOpenStart,k=IncrementalDOM.elementOpenEnd,h=(IncrementalDOM.elementVoid,IncrementalDOM.text),P=IncrementalDOM.attr,D=IncrementalDOM.skip;return"function"==typeof l&&(p.render=l),p}());
yalla.framework.addComponent("/dist/itinerary/edit-itinerary",function(){function ComponentEvent(type,data,target,currentTarget){this.data=data,this.target=target,this.type=type,this.currentTarget=currentTarget}function initState(){return{}}function onPropertyChange(){}function initState(props){return{entryType:props.entryType,itineraryId:props.itineraryId,packageId:props.packageId,datePair:{departure:new DatePair($patchChanges),checkIn:new DatePair($patchChanges,null,1)},data:{itinerary:null,airlines:null,airports:null,hotels:null},transportType:"Transport"==props.entryType?"Plane":"",alert:new Alert(null,$patchChanges,"alert")}}function getData(){var self=this;return new Promise(function(resolve){Promise.all([getAirports.bind(self)(),getAirlines.bind(self)(),getHotels.bind(self)(),getItinerary.bind(self)()]).then(function(result){var retval=result[3];retval.airlines=result[1],retval.airports=result[0],resolve(retval)})})}function getItinerary(){var self=this;return new Promise(function(resolve){(new Utils).itineraries.recommendedNewDates(self.state.packageId).then(function(data){if(self.state.datePair.departure.setDefaults(null,null,data),self.state.datePair.checkIn.setDefaults(null,null,data),self.state.itineraryId){var q={packageId:self.state.packageId,id:self.state.itineraryId};dpd.itineraries.get(q,function(itr,err){self.state.alert.alert(err),itr&&(self.state.entryType=itr.entry.transport?"Transport":"Hotel",self.state.transportType=itr.entry.transport?itr.entry.transportType?itr.entry.transportType:"Plane":"",self.state.data.itinerary=itr,resolve(self.state.data.itinerary))})}else self.state.data.itinerary={packageId:self.state.packageId,entry:{}},resolve(self.state.data.itinerary)})})}function getAirlines(){var self=this;return new Promise(function(resolve){self.state.data.airlines?resolve(self.state.data.airlines):dpd.airlines.get({$fields:{IATA:1,airline:1}},function(airlines){self.state.data.airlines=airlines.map(function(x){return{label:x.IATA+" - "+x.airline,value:x.IATA}}),resolve(self.state.data.airlines)})})}function getAirports(){var self=this;return new Promise(function(resolve){self.state.data.airports?resolve(self.state.data.airports):(new Utils).itineraries.airports().then(function(airports){self.state.data.airports=airports,resolve(self.state.data.airports)})})}function getHotels(){var self=this;return new Promise(function(resolve){self.state.data.hotels?resolve(self.state.data.hotels):dpd.hotels.get({contactPersonId:storage.me.read().id,$fields:{id:1,hotelName:1,city:1}},function(hotels){self.state.data.hotels=hotels.map(function(x){return{label:x.hotelName+" - "+x.city,city:x.city,value:x.id}}),resolve(self.state.data.hotels)})})}function onTransportTypeChange(){this.state.transportType=this.target.value,$patchChanges("spanTransport","departurePort","arrivalPort")}function whatTransportPrompt(){return"Plane"==this.state.transportType?"Airline":this.state.transportType+" Info"}function whatTransportEntryType(){return"Plane"==this.state.transportType?"lookup":"text"}function onCancel(){this.emitEvent("close")}function onSave(){var self=this,fe=this.target.form.elements,itr=self.state.data.itinerary;if(itr.id=fe.id.value,itr.packageId=fe.packageId.value,itr.entry={},itr.remarks=fe.remarks.value,"Hotel"==this.state.entryType)itr.entry.hotel=fe.hotel.value,itr.entry.city=fe.city.value,itr.entry.checkIn=new Date(fe.checkIn.value).setHours(23,35,35),itr.entry.checkOut=new Date(fe.checkOut.value).setHours(0,0,1);else{itr.entry.transport=fe.transport.value,itr.entry.departFrom=fe.departFrom.value,itr.entry.arriveAt=fe.arriveAt.value,itr.entry.departureCity="Plane"==self.state.transportType?fe.departureCity.value:null,itr.entry.arrivalCity="Plane"==self.state.transportType?fe.arrivalCity.value:null,itr.entry.departure=new Date(fe.departure.value).getTime(),itr.entry.arrival=new Date(fe.arrival.value).getTime(),itr.entry.transportType=fe.transportType.value;var err={errors:{}};if(fe.transport.value||(err.errors.transport="Missing value"),fe.departure.value||(err.errors.departure="Missing value"),fe.departFrom.value||(err.errors.departFrom="Missing value"),fe.arrival.value||(err.errors.arrival="Missing value"),fe.arriveAt.value||(err.errors.arriveAt="Missing value"),"Plane"==fe.transportType.value&&(itr.entry.flight=fe.flight.value,fe.transport.value&&!this.state.data.airlines.find(function(x){return x.value==fe.transport.value})&&(err.errors.transport="Unknown airline"),fe.flight.value||(err.errors.flight="Missing value"),fe.departFrom.value&&!this.state.data.airports.find(function(x){return x.value==fe.departFrom.value})&&(err.errors.departFrom="Unknown airport"),fe.arriveAt.value&&!this.state.data.airports.find(function(x){return x.value==fe.arriveAt.value})&&(err.errors.arriveAt="Unknown airport")),this.state.alert.alert(err),0!=Object.keys(err.errors).length)return}""==itr.id?dpd.itineraries.post(itr,function(result,err){self.state.alert.alert(err),result&&self.emitEvent("close")}):dpd.itineraries.put(itr.id,itr,function(result,err){self.state.alert.alert(err),result&&self.emitEvent("close")})}function isVisible(group){return this.state.entryType==group?"":"custom-set-hidden"}function onHotelSelected(event){this.target.form.city.value=event.data.label.split(" - ").slice(-1)}function onDepartFromSelected(event){this.target.form.departureCity.value=event.data.label.split(" - ").slice(-1)}function onArriveAtSelected(event){this.target.form.arrivalCity.value=event.data.label.split(" - ").slice(-1)}function $render(_props){_context.entry=$inject("/component/entry"),_context.entry,_context.alert=$inject("/component/alert"),_context.alert,_context.panel=$inject("/component/panel"),_context.panel,_elementOpenStart("div",""),_attr("element","dist.itinerary.edit-itinerary"),_elementOpenEnd("div");var _component=IncrementalDOM.currentElement(),_validComponent=yalla.framework.validComponentName(_component,_elementName);_component._state=_component._state&&_validComponent?_component._state:initState.bind(_component)(_props),_component._state._name=_elementName;var _state=_component._state,_self={component:_component,properties:_props,state:_component._state};_validComponent&&yalla.framework.propertyCheckChanges(_component._properties,_props,onPropertyChange.bind(_self)),_component._properties=_props;var _params={title:(_state.itineraryId?"Edit":"New")+" Entry",nofooter:"nofooter"};_context.panel.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(slotName){"body"===slotName&&(_elementOpenStart("div",""),_elementOpenEnd("div"),function(){function asyncFunc_1(data){_elementOpenStart("form",""),_elementOpenEnd("form"),_elementOpenStart("div",""),_elementOpenEnd("div"),yalla.framework.registerRef("alert",IncrementalDOM.currentElement(),function(){_elementOpenStart("input",""),_attr("type","hidden"),_attr("name","id"),_attr("value",data.id),_elementOpenEnd("input"),_elementClose("input"),_elementOpenStart("input",""),_attr("type","hidden"),_attr("name","packageId"),_attr("value",data.packageId),_elementOpenEnd("input"),_elementClose("input"),_elementOpenStart("div",""),_attr("class",isVisible.bind(self)("Transport")),_elementOpenEnd("div"),_elementOpenStart("div",""),_attr("class","row"),_elementOpenEnd("div"),_params={type:"select",name:"transportType",value:data.entry.transportType,prompt:"Transport",entries:["Plane","Bus","Train","Car","Ship"],onchange:function(event){var self={target:event.target};self.properties=_props,"elements"in self.target&&(self.elements=self.target.elements),self.currentTarget=this==event.target?self.target:_parentComponent(event.currentTarget),self.component=_component,self.component._state=self.component._state||{},self.state=self.component._state,self.emitEvent=function(eventName,data){var event=new ComponentEvent(eventName,data,self.target,self.currentTarget);"on"+eventName in _props&&_props["on"+eventName](event)},onTransportTypeChange.bind(self)()}},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),_elementClose("div"),_elementOpenStart("div",""),_attr("class","row"),_elementOpenEnd("div"),_elementOpenStart("div",""),_elementOpenEnd("div"),yalla.framework.registerRef("spanTransport",IncrementalDOM.currentElement(),function(){if(_params={type:whatTransportEntryType.bind(self)(),name:"transport",prompt:whatTransportPrompt.bind(self)(),value:data.entry.transport,entries:_state.data.airlines,required:"required",alert:_state.alert},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),"Plane"==_state.transportType){_elementOpenStart("div",""),_elementOpenEnd("div");var _params={type:"text",name:"flight",prompt:"Flight",uppercase:"uppercase",value:data.entry.flight,required:"required",alert:_state.alert};_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),_elementClose("div")}})(),_elementClose("div"),_params={type:"datetime-local",name:"departure",prompt:"Departure",value:data.entry.departure?data.entry.departure.toYYYYMMDD(!0):_state.datePair.departure.defaultStartDate(!0),min:_state.datePair.departure.minStartDate.bind(self)(!0),onfocusout:function(event){var self={target:event.target};self.properties=_props,"elements"in self.target&&(self.elements=self.target.elements),self.currentTarget=this==event.target?self.target:_parentComponent(event.currentTarget),self.component=_component,self.component._state=self.component._state||{},self.state=self.component._state,self.emitEvent=function(eventName,data){var event=new ComponentEvent(eventName,data,self.target,self.currentTarget);"on"+eventName in _props&&_props["on"+eventName](event)},_state.datePair.departure.onStartDateFocusOut.bind(self)("arrival")},required:"required",alert:_state.alert},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),_elementOpenStart("div",""),_elementOpenEnd("div"),yalla.framework.registerRef("departurePort",IncrementalDOM.currentElement(),function(){if(_params={type:whatTransportEntryType.bind(self)(),name:"departFrom",prompt:"Depart From",value:data.entry.departFrom,entries:_state.data.airports,required:"required",alert:_state.alert,lookupDelimiter:" - ",onlookupSelected:function(event){var self={target:event.target};self.properties=_props,"elements"in self.target&&(self.elements=self.target.elements),self.currentTarget=this==event.target?self.target:_parentComponent(event.currentTarget),self.component=_component,self.component._state=self.component._state||{},self.state=self.component._state,self.emitEvent=function(eventName,data){var event=new ComponentEvent(eventName,data,self.target,self.currentTarget);"on"+eventName in _props&&_props["on"+eventName](event)},onDepartFromSelected.bind(self)(event)}},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),"Plane"==_state.transportType){var _params={type:"text",name:"departureCity",value:data.entry.departureCity,required:"required",alert:_state.alert};_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){})}})(),_elementClose("div"),_elementOpenStart("div",""),_elementOpenEnd("div"),yalla.framework.registerRef("arrival",IncrementalDOM.currentElement(),function(){var _params={type:"datetime-local",name:"arrival",prompt:"Arrival",value:data.entry.arrival?data.entry.arrival.toYYYYMMDD(!0):_state.datePair.departure.defaultEndDate(!0),min:_state.datePair.departure.minEndDate.bind(self)(!0),required:"required",alert:_state.alert};_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){})})(),_elementClose("div"),_elementOpenStart("div",""),_elementOpenEnd("div"),yalla.framework.registerRef("arrivalPort",IncrementalDOM.currentElement(),function(){if(_params={type:whatTransportEntryType.bind(self)(),name:"arriveAt",prompt:"Arrive At",value:data.entry.arriveAt,entries:_state.data.airports,required:"required",alert:_state.alert,lookupDelimiter:" - ",onlookupSelected:function(event){var self={target:event.target};self.properties=_props,"elements"in self.target&&(self.elements=self.target.elements),self.currentTarget=this==event.target?self.target:_parentComponent(event.currentTarget),self.component=_component,self.component._state=self.component._state||{},self.state=self.component._state,self.emitEvent=function(eventName,data){var event=new ComponentEvent(eventName,data,self.target,self.currentTarget);"on"+eventName in _props&&_props["on"+eventName](event)},onArriveAtSelected.bind(self)(event)}},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),"Plane"==_state.transportType){var _params={type:"text",name:"arrivalCity",value:data.entry.arrivalCity,required:"required",alert:_state.alert};_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){})}})(),_elementClose("div"),_elementClose("div"),_elementClose("div"),_elementOpenStart("div",""),_attr("class",isVisible.bind(self)("Hotel")),_elementOpenEnd("div"),_elementOpenStart("div",""),_attr("class","row"),_elementOpenEnd("div"),_params={type:"date",name:"checkIn",prompt:"Check In",value:data.entry.checkIn?data.entry.checkIn.toYYYYMMDD():_state.datePair.checkIn.defaultStartDate(),min:_state.datePair.checkIn.minStartDate.bind(self)(),onfocusout:function(event){var self={target:event.target};self.properties=_props,"elements"in self.target&&(self.elements=self.target.elements),self.currentTarget=this==event.target?self.target:_parentComponent(event.currentTarget),self.component=_component,self.component._state=self.component._state||{},self.state=self.component._state,self.emitEvent=function(eventName,data){var event=new ComponentEvent(eventName,data,self.target,self.currentTarget);"on"+eventName in _props&&_props["on"+eventName](event)},_state.datePair.checkIn.onStartDateFocusOut.bind(self)("checkOut")},required:"required",alert:_state.alert},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),_elementOpenStart("span",""),_elementOpenEnd("span"),yalla.framework.registerRef("checkOut",IncrementalDOM.currentElement(),function(){var _params={type:"date",name:"checkOut",prompt:"Check Out",value:data.entry.checkOut?data.entry.checkOut.toYYYYMMDD():_state.datePair.checkIn.defaultEndDate(),min:_state.datePair.checkIn.minEndDate.bind(self)(),required:"required",alert:_state.alert};_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){})})(),_elementClose("span"),_params={type:"lookup",name:"hotel",prompt:"Hotel",value:data.entry.hotel,entries:_state.data.hotels,required:"required",alert:_state.alert,lookupDelimiter:" - ",onlookupSelected:function(event){var self={target:event.target};self.properties=_props,"elements"in self.target&&(self.elements=self.target.elements),self.currentTarget=this==event.target?self.target:_parentComponent(event.currentTarget),self.component=_component,self.component._state=self.component._state||{},self.state=self.component._state,self.emitEvent=function(eventName,data){var event=new ComponentEvent(eventName,data,self.target,self.currentTarget);"on"+eventName in _props&&_props["on"+eventName](event)},onHotelSelected.bind(self)(event)}},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),_params={type:"text",name:"city",prompt:"City",value:data.entry.city,required:"required",alert:_state.alert},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),_elementClose("div"),_elementClose("div"),_elementOpenStart("div",""),_attr("class","row"),_elementOpenEnd("div"),_params={type:"textarea",name:"remarks",prompt:"Remarks",value:data.remarks},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),_elementClose("div");var _params={alertType:_state.alert.type.bind(self)(),message:_state.alert.text.bind(self)()};_context.alert.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){})})(),_elementClose("div"),_elementOpenStart("div",""),_attr("class","row"),_elementOpenEnd("div"),_params={type:"button",value:"Save",divClass:"col-xs-6 col-sm-6 col-md-6 col-lg-6",onclick:function(event){var self={target:event.target};self.properties=_props,"elements"in self.target&&(self.elements=self.target.elements),self.currentTarget=this==event.target?self.target:_parentComponent(event.currentTarget),self.component=_component,self.component._state=self.component._state||{},self.state=self.component._state,self.emitEvent=function(eventName,data){var event=new ComponentEvent(eventName,data,self.target,self.currentTarget);"on"+eventName in _props&&_props["on"+eventName](event)},onSave.bind(self)()}},_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){});var _params={type:"button",value:"Cancel",divClass:"col-xs-6 col-sm-6 col-md-6 col-lg-6",onclick:function(event){var self={target:event.target};self.properties=_props,"elements"in self.target&&(self.elements=self.target.elements),self.currentTarget=this==event.target?self.target:_parentComponent(event.currentTarget),self.component=_component,self.component._state=self.component._state||{},self.state=self.component._state,self.emitEvent=function(eventName,data){var event=new ComponentEvent(eventName,data,self.target,self.currentTarget);"on"+eventName in _props&&_props["on"+eventName](event)},onCancel.bind(self)()}};_context.entry.render("object"==typeof arguments[1]?_merge(arguments[1],_params):_params,function(){}),_elementClose("div"),_elementClose("form")}var node={element:IncrementalDOM.currentElement(),pointer:IncrementalDOM.currentPointer()}.element,self={target:node};self.properties=_props,"elements"in self.target&&(self.elements=self.target.elements),self.currentTarget=self.target,self.component=_component,self.component._state=self.component._state||{},self.state=self.component._state;var promise=getData.bind(self)();promise&&"object"==typeof promise&&"then"in promise?(_skip(),promise.then(function(_result){$patchChanges(node,function(){asyncFunc_1.call(self,_result)})}).catch(function(){})):asyncFunc_1.call(self,promise)}(),_elementClose("div"))}),_elementClose("div")}var $patchChanges=yalla.framework.renderToScreen,$inject=yalla.framework.createInjector("/dist/itinerary/edit-itinerary"),$export={},_elementName="dist.itinerary.edit-itinerary",_context={},_parentComponent=yalla.framework.getParentComponent,_merge=yalla.utils.merge,_elementClose=(IncrementalDOM.elementOpen,IncrementalDOM.elementClose),_elementOpenStart=IncrementalDOM.elementOpenStart,_elementOpenEnd=IncrementalDOM.elementOpenEnd,_attr=(IncrementalDOM.elementVoid,IncrementalDOM.text,IncrementalDOM.attr),_skip=IncrementalDOM.skip;return"function"==typeof $render&&($export.render=$render),$export}());
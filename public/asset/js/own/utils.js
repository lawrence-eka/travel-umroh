function Utils(){var self=this;self.propertiesUpdater=function(target,source,which){for(var key in target)source.hasOwnProperty(key)&&(target[key]=source[key][which]);return target},self.generateUUID=function(){var d=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(d+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"===c?r:3&r|8).toString(16)})},self.itineraries={},self.itineraries.recommendedNewDates=function(packageId){return new Promise(function(resolve){var q={packageId:packageId,$sort:{fromDateTime:-1},$limit:1};dpd.itineraries.get(q,function(res){resolve(res.length?new Date(res[0].toDateTime):new Date)})})},self.bookings={paymentRejected:-3,bookingCancelled:-2,bookingExpired:-1,definingPassengers:0,waitingForPayment:1,paymentConfirmationPending:2,readyToGo:3,onGoing:4,finished:5},self.flow={booking:{statusCodes:[{code:"DPS",status:"Defining Passengers"},{code:"WFP",status:"Waiting for Payment"},{code:"WPV",status:"Waiting for Payment Verification"},{code:"RTG",status:"Ready to Go"},{code:"OGO",status:"On Going"},{code:"FIN",status:"Finished"},{code:"CCL",status:"Cancelled"},{code:"CNP",status:"Cancelled due to No Payment"},{code:"CPR",status:"Payment Rejected"}],transitions:[{from:"",to:"DPS",via:"bookingStarted"},{from:"DPS",to:"WFP",via:"passengersCompleted"},{from:"DPS",to:"CCL",via:"cancellation"},{from:"WFP",to:"WPV",via:"payment"},{from:"WFP",to:"DPS",via:"redefinePassengers"},{from:"WFP",to:"CNP",via:"noPayment"},{from:"WFP",to:"CCL",via:"cancellation"},{from:"WPV",to:"RTG",via:"paymentVerified"},{from:"WPV",to:"CPR",via:"paymentRejected"},{from:"WPV",to:"WFP",via:"paymentCancellation"},{from:"WPV",to:"CCL",via:"cancellation"},{from:"CPR",to:"WFP",via:"paymentCancellation"},{from:"CPR",to:"CCL",via:"cancellation"},{from:"RTG",to:"OGO",via:"execution"},{from:"RTG",to:"CCL",via:"cancellation"},{from:"OGO",to:"FIN",via:"executionCompleted"}],move:function(fromStatus,via){var t=self.flow.booking.transitions.find(function(item){return item.from==fromStatus&&item.via==via});return t?t.to:fromStatus},canGoTo:function(toStatus){var result=[];return self.flow.booking.transitions.filter(function(t){return t.to==toStatus}).forEach(function(item){result.push(item.from)}),result},canGoFrom:function(fromStatus){var result=[];return self.flow.booking.transitions.filter(function(t){return t.from==fromStatus}).forEach(function(item){result.push(item.to)}),result},isTransitionAllowed:function(fromStatus,toStatus,via){return void 0!==self.flow.booking.transitions.find(function(item){return item.from==fromStatus&&item.to==toStatus&&(!via||item.via==via)})},status:function(code){var statusCode=self.flow.booking.statusCodes.find(function(item){return item.code==code});return statusCode?statusCode.status:""}}},self.bookings.status=function(booking){return-1==booking.isPaymentConfirmed?{code:self.bookings.paymentRejected,text:"Payment Rejected"}:booking.isCancelled?{code:self.bookings.bookingCancelled,text:"Cancelled"}:booking.waitingForPaymentUntil&&booking.waitingForPaymentUntil<(new Date).getTime()?{code:self.bookings.bookingExpired,text:"Cancelled due to no Payment"}:booking.uniqueCode?booking.actualPayment?booking.isPaymentConfirmed?booking.travelDateFrom>(new Date).getTime()?{code:self.bookings.readyToGo,text:"Ready to Go"}:booking.travelDateUntil>=(new Date).getTime()?{code:self.bookings.onGoing,text:"On Going"}:{code:self.bookings.finished,text:"Finished"}:{code:self.bookings.paymentConfirmationPending,text:"Payment Confirmation Pending"}:{code:self.bookings.waitingForPayment,text:"Waiting for Payment"}:{code:self.bookings.definingPassengers,text:"Defining Passengers"}},Object.freeze(self.bookings)}
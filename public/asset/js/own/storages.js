function ScriptCache(){this.version=storage.local.read("scriptsVersion"),this.scripts=storage.local.read("scripts")?JSON.parse(storage.local.read("scripts")):{},this.promises={},this.isReset=!1,this.addPromise=function(url,attribute,resolve,reject){return this.promises[url]||(this.promises[url]=[]),this.promises[url].push({resolve:resolve,reject:reject}),attribute&&(this.scripts[url]={attribute:attribute}),1==this.promises[url].length},this.getScript=function(url,getCompleteData){if(!this.scripts[url])return null;if(getCompleteData){var completeData=this.scripts[url];return completeData.url=url,completeData}return this.scripts[url].req},this.fulfillPromises=function(url,isResolve,resolveCompleteData){if(this.promises[url]&&this.scripts[url])for(;this.promises[url].length;)this.promises[url][0][isResolve?"resolve":"reject"](this.getScript(url,resolveCompleteData)),this.promises[url].splice(0,1)},this.setVersion=function(currentVersion){this.version!=currentVersion&&(this.version=currentVersion,this.scripts={},this.promises={},storage.local.save("scriptsVersion",currentVersion),storage.local.erase("scripts"),this.isReset=!0)},this.setScript=function(url,req,resolveCompleteData){req?(attribute=this.scripts[url]?this.scripts[url].attribute:null,this.scripts[url]={req:{response:req.response,responseText:req.responseText},attribute:attribute},this.fulfillPromises(url,!0,resolveCompleteData)):(this.fulfillPromises(url,!1,resolveCompleteData),delete this.scripts[url]),storage.local.save("scripts",JSON.stringify(this.scripts))}}function Loader(){this.unloadedAssets=0,this.needLoading=!1,this.assets=[{seq:2,file:"asset/css/form-panel.css"},{seq:2,file:"asset/css/font-awesome.min.css"},{seq:2,file:"asset/css/bootstrap.min.css"},{seq:3,file:"asset/css/css-patch.css"},{seq:2,file:"asset/css/custom-style.css"},{seq:2,file:"asset/css/ie10-viewport-bug-workaround.css"},{seq:2,file:"asset/css/sticky-footer-navbar.css"},{seq:2,file:"asset/js/jquery.min.js"},{seq:4,file:"asset/js/bootstrap.min.js"},{seq:2,file:"dpd.js"},{seq:2,file:"asset/js/own/prototypes.js"},{seq:2,file:"asset/js/own/datePair.js"},{seq:2,file:"asset/js/own/alert.js"},{seq:2,file:"asset/js/own/utils.js"},{seq:2,file:"asset/js/own/event.js"},{seq:0,file:"dist/yalla.js",attribute:{id:"yallaScript","yalla-component":"app","yalla-base":"dist","yalla-domtarget":"body","yalla-routing":"authenticate"}},{seq:1,file:"asset/js/own/yalla-patch.js"}],this.loadAssets=function(seq){for(var i in this.assets)this.assets[i].seq!=seq||this.assets[i].called||(this.assets[i].called=!0,this.fetch("./"+this.assets[i].file,null,this.assets[i].attribute).then(this.attachScriptToDocument.bind(this,seq)))},this.fetch=function(url,postData,attribute){function createXMLHTTPObject(){for(var xmlhttp=!1,i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]()}catch(e){continue}break}return xmlhttp}var XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return new Promise(function(resolve,reject){var script=scriptCache.getScript(url,!0);if(script&&script.req)return void resolve(script);if(scriptCache.addPromise(url,attribute,resolve,reject)){var req=createXMLHTTPObject();if(req.timeout=2e4,req){var method=postData?"POST":"GET";req.open(method,url,!0),postData&&req.setRequestHeader("Content-type","application/json"),req.ontimeout=function(){scriptCache.setScript(url,null,!0)},req.onreadystatechange=function(){if(4==req.readyState)return 200!=req.status&&304!=req.status?void scriptCache.setScript(url,null,!0):void scriptCache.setScript(url,req,!0)},4!=req.readyState&&req.send(JSON.stringify(postData))}}})},this.attachScriptToDocument=function(seq,scriptData){var s=null,url=scriptData.url,attribute=scriptData.attribute,self=this;if(url){if(url.indexOf(".js")>=0){if(s=document.createElement("script"),s.type="text/javascript",s.text=scriptData.req.responseText,attribute)for(var prop in attribute)attribute.hasOwnProperty(prop)&&s.setAttribute(prop,attribute[prop])}else{s=document.createElement("style"),s.type="text/css";var css=scriptData.req.responseText;s.styleSheet?s.styleSheet.cssText=css:s.appendChild(document.createTextNode(css))}if(document.head.appendChild(s),self.unloadedAssets--,url.indexOf("dist/yalla.js")>=0){var ego=self;window.onload=function(){ego.needLoading=!0}}else if(0==self.unloadedAssets){var ego=self;window.onload=function(){ego.needLoading=!1,yalla.framework.start()},self.needLoading||scriptCache.isReset?(yalla.framework.start(),scriptCache.isReset=!1):0==self.unloadedAssets}self.loadAssets(seq+1)}},this.unloadedAssets=this.assets.length}var storage={cookie:{},local:{},session:{},me:{}};storage.cookie.save=function(name,value,days){if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3);var expires="; expires="+date.toGMTString()}else var expires="";document.cookie=name+"="+value+expires+"; path=/"},storage.cookie.read=function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null},storage.cookie.erase=function(name){storage.cookie.create(name,"",-1)},storage.local.save=function(key,value){localStorage.setItem(key,value)},storage.local.read=function(key){return localStorage.getItem(key)},storage.local.erase=function(key){localStorage.removeItem(key)},storage.session.save=function(key,value){sessionStorage.setItem(key,value)},storage.session.read=function(key){return sessionStorage.getItem(key)},storage.session.erase=function(key){sessionStorage.removeItem(key)},storage.me.save=function(me,remember){storage.me.erase(),remember?storage.local.save("me",JSON.stringify(me)):storage.session.save("me",JSON.stringify(me))},storage.me.read=function(){var me=storage.session.read("me");return me||(me=storage.local.read("me")),me&&(me=JSON.parse(me))?(storage.cookie.read("sid")||storage.cookie.save("sid",me.sid),me):null},storage.me.isRemembered=function(){return!!storage.local.read("me")},storage.me.erase=function(){storage.local.erase("me"),storage.session.erase("me")};var scriptCache=new ScriptCache,loader=new Loader;
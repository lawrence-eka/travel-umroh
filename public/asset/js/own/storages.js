var storage={cookie:{},local:{},session:{},me:{}};storage.cookie.save=function(name,value,days){if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3);var expires="; expires="+date.toGMTString()}else var expires="";document.cookie=name+"="+value+expires+"; path=/"},storage.cookie.read=function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null},storage.cookie.erase=function(name){storage.cookie.create(name,"",-1)},storage.local.save=function(key,value){localStorage.setItem(key,value)},storage.local.read=function(key){return localStorage.getItem(key)},storage.local.erase=function(key){localStorage.removeItem(key)},storage.session.save=function(key,value){sessionStorage.setItem(key,value)},storage.session.read=function(key){return sessionStorage.getItem(key)},storage.session.erase=function(key){sessionStorage.removeItem(key)},storage.me.save=function(me,remember){storage.me.erase(),remember?storage.local.save("me",JSON.stringify(me)):storage.session.save("me",JSON.stringify(me))},storage.me.read=function(){var me=storage.session.read("me");return me||(me=storage.local.read("me")),me?JSON.parse(me):null},storage.me.isRemembered=function(){return!!storage.local.read("me")},storage.me.erase=function(){storage.local.erase("me"),storage.session.erase("me")};var scriptCache={scripts:storage.session.read("scripts")?JSON.parse(storage.session.read("scripts")):{},promises:{},addPromise:function(url,attribute,resolve,reject){return this.promises[url]||(this.promises[url]=[]),this.promises[url].push({resolve:resolve,reject:reject}),attribute&&(this.scripts[url]={attribute:attribute}),1==this.promises[url].length},fulfillPromises:function(url,isResolve){if(this.promises[url]&&this.scripts[url])for(;this.promises[url].length;)this.promises[url][0][isResolve?"resolve":"reject"](this.scripts[url].req),this.promises[url].splice(0,1)},setScript:function(url,req){req?(attribute=this.scripts[url]?this.scripts[url].attribute:null,this.scripts[url]={req:{response:req.response,responseText:req.responseText},attribute:attribute},this.fulfillPromises(url,!0)):(this.fulfillPromises(url,!1),delete this.scripts[url]),storage.session.save("scripts",JSON.stringify(this.scripts))}},loader={};loader.fetch=function(url,postData,attribute){function createXMLHTTPObject(){for(var xmlhttp=!1,i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]()}catch(e){continue}break}return xmlhttp}var XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return new Promise(function(resolve,reject){if(scriptCache.scripts[url]&&scriptCache.scripts[url].req)return void resolve(scriptCache.scripts[url].req);if(scriptCache.addPromise(url,attribute,resolve,reject)){var req=createXMLHTTPObject();if(req.timeout=2e3,req){var method=postData?"POST":"GET";req.open(method,url,!0),postData&&req.setRequestHeader("Content-type","application/json"),req.ontimeout=function(){scriptCache.setScript(url,null)},req.onreadystatechange=function(){if(4==req.readyState)return 200!=req.status&&304!=req.status?void scriptCache.setScript(url,null):void scriptCache.setScript(url,req)},4!=req.readyState&&req.send(JSON.stringify(postData))}}})},loader.attachScriptToDocument=function(url){var s=null;if(url.indexOf(".js")>=0){if(s=document.createElement("script"),s.type="text/javascript",s.text=scriptCache.scripts["."+url].req.responseText,attribute=scriptCache.scripts["."+url].attribute,attribute)for(var prop in attribute)attribute.hasOwnProperty(prop)&&s.setAttribute(prop,attribute[prop])}else{s=document.createElement("style"),s.type="text/css";var css=scriptCache.scripts["."+url].req.responseText;s.styleSheet?s.styleSheet.cssText=css:s.appendChild(document.createTextNode(css))}document.head.appendChild(s)};
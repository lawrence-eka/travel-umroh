<inject from="/component/card-booking" name="card-booking"></inject>
<inject from="/component/card" name="card"></inject>

<div data.load="getBookings()">
    <p for.each="bkg in data">
        <card-booking bkg.bind="bkg" click.trigger="generateLink(bkg.id)"></card-booking>
    </p>
</div>

<script>
    var errorMessage="";

    function queryBookings(userId) {
        return new Promise(function(resolve) {
            var q = {"userId": userId};
            dpd.bookings.get(q, function (bkg, err) {
                if (err) {
                    errorMessage = err.message;
                    $patchChanges();
                } else {
                    resolve(bkg);
                }
                ;
            });
        });
    }

    function getBookings(){
        return new Promise(function(resolve) {
            dpd.users.me(function(me) {
                queryBookings(me.id).then(function(bkg) {
                    resolve(bkg);
                });

            });
        });
    }

    function generateLink(id){
	    window.location.hash = '#app/action.bookPackage:bookingId='+id;
    }
</script>
<inject from="/component/userProfile" name="profile"></inject>

<div>
    <profile profile.bind="getMyProfile()" save.trigger="onSave(event)" cancel.trigger="onCancel()" errorMessage.bind="@error.message"></profile>
</div>

<script>


    function initState() {
        return {
            error : {
                message : ''
            }
        };
    }

    function getMyProfile(){

		return new Promise(function(resolve) {
            dpd.users.me(function(me) {
                    resolve(me);
                });
		});
	}

	function onCancel() {
		window.location.hash = "#app";
	}
	function onSave(profile){
	    profile = profile.data;
        var self = this;
        dpd.users.put(profile.id, profile, function(user, err) {
            if(err) {
                self.state.error.message = err;
            } else {
                window.location.hash = '#app';
            }
        });
	}
</script>


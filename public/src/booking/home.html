<inject from="/booking/list" name="list"></inject>
<inject from="/booking/card-booking" name="card-booking"></inject>
<inject from="/component/alert" name="alert"></inject>
<inject from="/component/entry" name="entry"></inject>
<inject from="/component/panel" name="panel"></inject>
<inject from="/component/ppLink" name="ppLink"></inject>
<link href="asset/css/custom-style.css" rel="stylesheet">

<div data.load="loadBooking($bookingId)">
	<span ref.name="alert">
		<alert message.bind="@alert.text()" alertType.bind="@alert.type()"></alert>
	</span>
	<div if.bind="@editedBooking">
		<card-booking booking.bind="@editedBooking" saved.trigger="onBookingSaved()" cancelled.trigger="onBookingCancelled()"></card-booking>
	</div>
	<div if.bind="!@editedBooking">
		<list editBooking.trigger="onEditBooking(event)"></list>
	</div>
	<!--
	<edit-passenger passengerId.bind="@passengerId"></edit-passenger>
	<div data.load="getPassengers(@bookingId)">
		<p for.each="psg in data">
			<card-passenger passenger.bind="psg"></card-passenger>
		</p>
	</div>
	-->
</div>


<script>
	function initState(props) {
		//debugger;
		return {
			alert: new Alert(null, $patchChanges, "alert"),
			editedBooking: props.booking,
			passengerId: null,
		}
	}
/*
	function onPropertyChange(props){
		debugger;
		if(props.editedBooking) this.state.editedBooking = props.editedBooking.newValue;
	}
*/
	function loadBooking(id) {
		var self = this;
		return new Promise(function(resolve){
			//debugger;
			if(!id) resolve(null);
			else {
				dpd.bookings.get(id, function(bkg, err){
					//debugger;
					self.state.alert.alert(err);
					self.state.editedBooking = bkg;
					resolve(bkg);
				});
			}
		});
	}

	function onEditBooking(event){
		this.state.editedBooking = event.data;
		$patchChanges();
	}
	function onBookingSaved() {
		this.state.editedBooking = null;
		$patchChanges();
	}

	function onBookingCancelled() {
		this.state.editedBooking = null;
		$patchChanges();
	}

</script>
<div>
    <div>
        {{errorMessage}}
    </div>
    <form submit.trigger="register(this)" >
        <p>First Name: <input type="text" name="firstName"></p>
        <p>Last Name: <input type="text" name="lastName"></p>
        <p>Username: <input type="text" name="username"></p>
        <p>Email: <input type="text" name="email"></p>
        <p>Password: <input type="password" name="password"></p>
        <p>Repeat Password: <input type="password" name="repeatPassword"></p>
        <p><input type="submit" value="Register"></p>
    </form>
</div>

<script>

    var errorMessage = '';

    function register(form){
        var firstName = form.elements.firstName.value;
        var lastName = form.elements.lastName.value;
        var email = form.elements.email.value;
        var username = form.elements.username.value;
        var password = form.elements.password.value;
        var repeatPassword = form.elements.repeatPassword.value;
        dpd.users.post({"username": username, "password": password, "firstName": firstName, "lastName": lastName, "email": email}, function(user, err) {
            if(err){
                errorMessage = JSON.stringify(err);
                $patchChanges();
            }else{
                dpd.users.login({"username": username, "password": password}, function(user, err) {
                    if(err){
                        errorMessage = JSON.stringify(err);
                        $patchChanges();
                    }else{
                        window.location.hash = '#app/home';
                    }
                });
            }
        });
        return false;
    }
</script>


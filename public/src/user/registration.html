<link href="asset/css/registration.css" rel="stylesheet">
<inject from="/component/alert" name="alert"></inject>
<inject from="/component/userProfile" name="profile"></inject>

<profile save.trigger="register(event)" cancel.trigger="cancelRegistration()"></profile>

<script>

    var errorMessage = '';

    function cancelRegistration() {
        window.location.hash = "#app";
    }
    function register(profile){
        dpd.users.post(profile, function(user, err) {
            if(err){
                errorMessage = err.message;
                $patchChanges();
            }else{
                dpd.users.login({"username": q.username, "password": q.password}, function(user, err) {
                    if(err){
                        errorMessage = err.message;
                        $patchChanges();
                    }else{
                        window.location.hash = '#app';
                    }
                });
            }
        });
        return false;
    }
</script>


<link href="asset/css/registration.css" rel="stylesheet">
<inject from="/component/alert" name="alert"></inject>
<inject from="/component/userProfile" name="profile"></inject>

<div class="container margin-top-15px">
    <profile save.trigger="register(event)" cancel.trigger="cancelRegistration()"></profile>
</div>

<script>

    var errorMessage = '';

    function cancelRegistration() {
        window.location.hash = "#app";
    }
    function register(profile){
        return new Promise(function(resolve){
            dpd.users.post(profile, function(user, err) {
                if(err){
                    resolve(err);
                }else{
                    dpd.users.login({"username": profile.username, "password": profile.password}, function(user, err) {
                        if(err){
                            resolve(err);
                        }else{
                            window.location.hash = '#app';
                            resolve(null);
                        }
                    });
                }
            });
        });
    }
</script>


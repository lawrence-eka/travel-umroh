<inject from="/user/userProfile" name="profile"></inject>

<div>
    <profile profile.bind="getMyProfile()" save.trigger="onSave(event)" cancel.trigger="onCancel()" errorMessage.bind="@error.message"></profile>
</div>

<script>


    function initState() {
        return {
            error : {
                message : ''
            }
        };
    }

    function getMyProfile(){
		return new Promise(function(resolve) {
            dpd.users.me(function(me) {
            	debugger;
                    resolve(me);
                });
		});
	}

	function onCancel() {
		window.location.hash = "#app/search-package.home";
	}
	function onSave(profile){
	    profile = profile.data;
        var self = this;
        dpd.users.put(profile.id, profile, function(user, err) {
            if(err) {
                self.state.error.message = err;
            } else {
            	storage.me.save(me, storage.me.isRemembered());
                window.location.hash = '#app/search-package.home';
            }
        });
	}
</script>


<inject from="/component/alert" name="alert"></inject>
<inject from="/component/panel" name="panel"></inject>
<inject from="/component/entry" name="entry"></inject>
<link href="asset/css/custom-style.css" rel="stylesheet">


<div class="container  margin-top-login-panel">
    <panel nofooter notitle>
        <div slot.name="body">
            <h2 class="form-signin-heading">Please sign in</h2>
            <form>
                <entry type="text" name="username" required placeholder="Email"></entry>
                <entry type="password" name="password" placeholder="Password"></entry>
                <entry type="checkbox" name="rememberMe" prompt="Remember me"></entry>
                <entry type="button" value="Sign In" click.trigger="login()"></entry>
                <div class="form-group custom-entry-margin">
                    <a href="#user.registration" class="custom-entry-prompt">New to MarKiMroh? Register here</a>
                    <a href="#common.privacyPolicy" class="custom-entry-prompt">Privacy Policy</a>
                </div>
            </form>
            <alert alertType.bind="'error'" message.bind="errorMessage"></alert>
        </div>
    </panel>
</div> <!-- /container -->


<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../assets/js/ie10-viewport-bug-workaround.js"></script>
</body>
</html>
<script>

    var errorMessage = '';

    function login(){
        var form = this.target.form;
        errorMessage = "";
        var userName = form.elements.username.value.toLowerCase();
        var password = form.elements.password.value;
        var rememberMe = form.elements.rememberMe.checked;

        form.elements.username.value = '';
        form.elements.password.value = '';
        form.elements.rememberMe.checked = false;

        dpd.users.login({"username": userName, "password": password}, function(user, err) {
            if(err){
                errorMessage = err.message;
	            $patchChanges();
            } else {
                dpd.users.me(function(me){
	                storage.me.save(me, rememberMe);
	                window.location.hash="#app/action.searchPackage"
	                $patchChanges();
                });
            }
        });
    }
</script>


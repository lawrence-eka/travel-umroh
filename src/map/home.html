<inject from="/component/panel" name="panel"></inject>
<inject from="/component/home-button" name="home"></inject>

<div>
    <panel title='Map'>
        <div slot.name='body' name = 'map' style='width:100%;height:600px'>
        </div>
        <div slot.name="footer">
            <div class="row">
                <home></home>
            </div>
        </div>
    </panel>
</div>

<script>
	var watchID = null;
	var marker = null;
	var circle = null;

	function initMap(loc) {
		getGeoLoc().then(function(loc) {
			var map = new google.maps.Map(document.getElementsByName('map')[0], {
				zoom: 17,
				center: loc,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});

			marker = new google.maps.Marker({
				position: loc,
				map: map,
				animation: google.maps.Animation.DROP,
			});

			circle = new google.maps.Circle({
                center: loc,
                radius: loc.acc,
                map: map,
                fillColor: '#0000ff',
                fillOpacity: 0.3,
                strokeColor: '#0000ff',
                strokeOpacity: 0.0,
            });

			var options = {enableHighAccuracy: true,timeout: 10000};
			watchID = navigator.geolocation.watchPosition(onSuccess, onError, options);
		});
	}

	function onSuccess(position) {
		var l = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

		marker.setPosition(l);
		circle.setCenter(l);
		circle.setRadius(position.coords.accuracy);
	}

	// clear the watch that was started earlier
	//
	function clearWatch() {
		if (watchID != null) {
			navigator.geolocation.clearWatch(watchID);
			watchID = null;
		}
	}

	// onError Callback receives a PositionError object
	//
	function onError(error) {
		console.log(JSON.stringify(error));
	}
    google.maps.event.addDomListener(window, 'load', initMap);

</script>
